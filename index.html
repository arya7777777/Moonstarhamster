<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🌙✨ Hamster's Secure Message Portal 🐹</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #0b3d91 0%, #1e1e2f 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #eee;
    }
    .container {
      background: rgba(30, 30, 47, 0.96);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.7);
      max-width: 650px;
      width: 97vw;
      text-align: center;
      position: relative;
    }
    h1 {
      margin-bottom: 25px;
      font-size: 2.5em;
      color: #ffd700;
      text-shadow: 0 0 8px #fff, 0 0 25px #ffd700;
    }
    .emoji-stars { font-size: 1.2em; margin-bottom: 18px; }
    .input-group { margin-bottom: 20px; text-align: left; color: #ccc; }
    label { font-weight: bold; display: block; margin-bottom: 6px;}
    input[type="password"] {
      width: 100%;
      padding: 12px 15px;
      font-size: 18px;
      border-radius: 10px;
      border: none;
      outline: none;
      background: #1a1a2e;
      color: #fff;
      box-shadow: inset 0 0 8px #444;
      transition: box-shadow 0.3s;
    }
    input[type="password"]:focus { box-shadow: inset 0 0 12px #ffd700; }
    button.btn {
      background: #ffd700;
      color: #1e1e2f;
      font-weight: bold;
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
      margin: 10px 7px;
      box-shadow: 0 5px 15px rgba(255,215,0,0.7);
    }
    button.btn:hover {
      background: #ffea00;
      box-shadow: 0 8px 20px rgba(255,235,20,0.9);
      transform: translateY(-2px);
    }
    .error {
      color: #ff4040;
      margin-top: 12px;
      font-weight: 700;
      text-shadow: 0 0 6px #ff0000;
      text-align:center;
    }
    .info {
      font-size: 0.9em;
      margin-top: 15px;
      color: #aaa;
      line-height: 1.4;
    }
    .logout-btn {
      background: #ff4646;
      box-shadow: 0 4px 10px rgba(255, 70, 70, 0.8);
    }
    .logout-btn:hover {
      background: #ff2a2a;
      box-shadow: 0 6px 15px rgba(255, 50, 50, 0.9);
    }
    .date-info {
      background: #1e1e3e;
      border-radius: 8px;
      padding: 10px 15px;
      margin-bottom: 15px;
      font-weight: 600;
      font-size: 1.05em;
      text-shadow: 0 0 4px #555;
      color: #f0e68c;
    }
    .message-content { display: none; }
    .message-box {
      background: #222244;
      border-radius: 12px;
      padding: 20px;
      margin: 24px 0;
      font-family: 'Courier New', monospace;
      font-size: 1.13em;
      color: #f0e68c;
      box-shadow: 0 4px 18px #0007;
      min-height: 80px;
      text-align: left;
      position: relative;
      word-break: break-word;
    }
    .msg-date-label {
      color:#ffd700;
      font-weight: bold;
      font-family: Arial, sans-serif;
      font-size: 1.09em;
      margin-bottom: 12px;
      display: inline-block;
      letter-spacing: 0.04em;
    }
    .feedback-section { margin-top: 40px;}
    .feedback-heading { 
      color: #ffd700; font-size: 1.25em;
      text-shadow: 0 0 8px #fff7, 0 0 15px #ffd70077;
      margin-bottom: 12px; font-weight: 700;}
    .feedback-list {margin-bottom:32px;}
    .feedback-item { background: #292946; border-radius:13px; box-shadow:0 2px 10px #000a; color:#fffbe0; margin-bottom:18px; padding:16px 18px 10px 14px; position:relative; border-left:4px solid #ffd700;}
    .feedback-meta {margin-bottom:3px; font-size:0.97em; color:#ffd900; font-weight:bold; letter-spacing:.04em; opacity:.88;}
    .feedback-content {margin-left:8px; font-size:1.12em; word-break:break-word;}
    .reply-btn { background:#fffac3; color:#232333; padding:3px 13px; font-size:0.98em; border-radius:7px; border:none; margin-top:8px; margin-right:7px; cursor:pointer; box-shadow:0 1px 4px #ffd70066; font-weight:600; transition:background 0.18s;}
    .reply-btn:hover {background:#ffd700;color:#111;}
    .reply-list {margin-top:7px;margin-left:17px;}
    .reply-item {background:#443b5e;color:#fff6a8;border-radius:9px;margin:6px 0 0 0;padding:9px 10px 5px 10px;font-size:0.99em;box-shadow:0 1px 6px #0005;border-left:3px solid #ffd700bb;}
  </style>
</head>
<body>
  <div class="container">
    <div id="loginForm" class="login-form">
      <h1>🌙✨ Hamster's Secure Message Portal 🐹</h1>
      <div class="emoji-stars">🌟🌙⭐🐹✨🌙⭐🌟🐹✨🌙⭐</div>
      <form id="loginFormElem">
        <div class="input-group">
          <label for="password">Enter Password:</label>
          <input type="password" id="password" autocomplete="off" required />
        </div>
        <button type="submit" class="btn">Access Messages</button>
      </form>
      <div id="error" class="error"></div>
      <div class="info">
        🔒 This portal contains all your messages with memories and wishes.<br />
        💡 Enter the correct password to view, post, and remember.
      </div>
    </div>
    <div id="messageContent" class="message-content" style="display: none;">
      <h1>📋 Message Memories</h1>
      <div class="date-info">📅 Last Seen: <span id="currentDate"></span></div>
      <div class="message-box">
        <div class="msg-date-label">🗓️ September 7, 2025</div>
        Nannuu mere bachee pyaaru thank you so much 🥺 aapne message kiya mujhe bohot sukoon mila halaki fir b aapne silent nhi Kiya even 12 :30 tak insta pe online show ho rha tha ,But nannu aajkal bohot stress hone lgaa hai snjh nhi aarha kuch b , aaap apna dhyan rkh rhe ho na? ache se khaa rhe ho na? please dua krna nannu mera mann shaant ho jaye pt nhi kya ho rha hai mujhe , aapki yaad bohot aati hai nannuu please mujhe btana kya pray kru taaki mann shant ho aur kaam pe dhyan rhe i Miss you too much zuc vuuu I really miss mera bchaa 
        upar wala kal ka message hai idk aapne dekha ya nhi 
         today:- Hmmmmmm Yaaad aaati hai kehna ek Bohot chota word hai lf what i feel without talking to you , Ab to khud ko pehchana bhi nahi jaata  ab log bi  nhi pehchan paate mujje tanha aapse door sabhi meri aankhon me bhi aapko hi dhoondtw hai , Kaise btaau  kaise lgta hai apse baat nhi ho paati ab , Khudaya Jaane kya likha hai   ....      Aap apna Dhyan Rkha Kro Bachaaa Ache se khaya Kro Ache se soya kro     paani ki bottle le jaane ki aadat daalo please Nannu 🥺🥺 Mera pyaara bachaa thank you so much for everything 
      </div>
      <!-- Feedback Section Starts -->
      <div class="feedback-section">
        <div class="feedback-heading">🌙 Leave a Feedback or Reply</div>
        <form id="mainFeedbackForm" style="margin-bottom:1em;">
          <textarea id="mainFbText" placeholder="Leave your feedback..." required style="width:90%;min-height:48px;border-radius:8px;"></textarea><br>
          <button type="submit" class="btn">Post</button>
        </form>
        <div id="feedbackList" class="feedback-list">Loading...</div>
      </div>
      <!-- Feedback Section Ends -->
      <button id="logoutBtn" class="btn logout-btn" style="margin-top:16px;">🚪 Logout</button>
      <div class="info">
        ⭐ Show your support with a Like!<br>
        🖼️ Photo is always visible and best quality.
      </div>
    </div>
  </div>
  <script>
    const CORRECT_PASSWORD = "MOONSTAR131";
    const loginFormElem = document.getElementById('loginFormElem');
    const loginForm = document.getElementById('loginForm');
    const messageContent = document.getElementById('messageContent');
    const passwordInput = document.getElementById('password');
    const errorDiv = document.getElementById('error');
    const currentDateSpan = document.getElementById('currentDate');
    const logoutBtn = document.getElementById('logoutBtn');
    loginFormElem.onsubmit = function(event) {
      event.preventDefault();
      if(passwordInput.value === CORRECT_PASSWORD){
        loginForm.style.display = "none";
        messageContent.style.display = "block";
        errorDiv.textContent = "";
        updateCurrentDate();
        if(!window.firebaseLoaded){
          window.firebaseLoaded = true;
          loadFirebaseFeedback();
        }
      } else {
        errorDiv.textContent = "❌ Incorrect password. Please try again.";
        passwordInput.value = "";
      }
    };
    if(logoutBtn){
      logoutBtn.onclick = function(){
        loginForm.style.display = "block";
        messageContent.style.display = "none";
        passwordInput.value = "";
        errorDiv.textContent = "";
      }
    }
    function updateCurrentDate(){
      const now = new Date();
      const options = { year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit", timeZone: "Asia/Kolkata" };
      currentDateSpan.textContent = now.toLocaleDateString("en-IN", options) + " IST";
    }
    let inactivityTimer;
    function resetInactivityTimer(){
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        if(messageContent.style.display === "block"){
          loginForm.style.display = "block";
          messageContent.style.display = "none";
          passwordInput.value = "";
          errorDiv.textContent = "";
          alert("⏰ Session expired due to inactivity. Please login again.");
        }
      }, 30*60*1000);
    }
    document.addEventListener('click', resetInactivityTimer);
    document.addEventListener('keypress', resetInactivityTimer);
    resetInactivityTimer();

    // Fixed Feedback box logic:
    function loadFirebaseFeedback() {
      const script = document.createElement('script');
      script.type = "module";
      script.innerHTML = `
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, orderBy, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = {
          apiKey: "AIzaSyD4ZMuhDC02sDJX2XTsVhW6lzpdXi-c1WE",
          authDomain: "hamster-portal-581b1.firebaseapp.com",
          projectId: "hamster-portal-581b1",
          storageBucket: "hamster-portal-581b1.firebasestorage.app",
          messagingSenderId: "834640510947",
          appId: "1:834640510947:web:99e169a6ed8ef6e3d2ead6"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const feedbackList = document.getElementById('feedbackList');
        const mainFeedbackForm = document.getElementById('mainFeedbackForm');
        const mainFbText = document.getElementById('mainFbText');

        async function postFeedback(text, parentId = null) {
          await addDoc(collection(db, "feedbacks"), {
            text,
            parentId,
            timestamp: serverTimestamp()
          });
          await loadFeedbacks();
        }

        mainFeedbackForm.onsubmit = async (e) => {
          e.preventDefault();
          const text = mainFbText.value.trim();
          if (text) {
            await postFeedback(text); // parentId = null for main feedback
            mainFbText.value = "";
          }
        };

        async function loadFeedbacks() {
          feedbackList.innerHTML = "Loading...";
          const cutoff = new Date(Date.now() - 24*60*60*1000);
          const mainQ = query(
            collection(db, "feedbacks"),
            where("parentId", "==", null),
            where("timestamp", ">=", cutoff),
            orderBy("timestamp", "desc")
          );
          const mainSnaps = await getDocs(mainQ);
          if (mainSnaps.empty) {
            feedbackList.innerHTML = "<i>No feedback yet, be first!</i>";
            return;
          }
          let html = "";
          for (const doc of mainSnaps.docs) {
            const d = doc.data();
            const dt = (d.timestamp && d.timestamp.toDate) ? d.timestamp.toDate().toLocaleString() : "Just now";
            html += \`
              <div class="feedback-item" style="margin-top:20px;">
                <div class="feedback-meta">Visitor • 🕒 \${dt}</div>
                <div class="feedback-content">\${d.text}</div>
                <form data-parent="\${doc.id}" style="margin-top:5px;">
                  <input type="text" placeholder="Reply..." required style="width:65%;padding:5px;border-radius:7px;">
                  <button type="submit" class="reply-btn">Reply</button>
                </form>
                <div class="reply-list" id="replies-\${doc.id}" style="margin-left:12px;margin-top:5px;"></div>
              </div>
            \`;
          }
          feedbackList.innerHTML = html;
          document.querySelectorAll('form[data-parent]').forEach(form => {
            form.onsubmit = async (e) => {
              e.preventDefault();
              const parentId = form.getAttribute("data-parent");
              const inp = form.querySelector("input");
              const reply = inp.value.trim();
              if(reply){
                await postFeedback(reply, parentId);
                inp.value = "";
                await loadReplies(parentId);
              }
            }
          });
          for (const doc of mainSnaps.docs) {
            await loadReplies(doc.id);
          }
        }

        async function loadReplies(parentId) {
          const repliesQ = query(
            collection(db, "feedbacks"),
            where("parentId", "==", parentId),
            orderBy("timestamp", "asc")
          );
          const repliesSnaps = await getDocs(repliesQ);
          const repliesEl = document.getElementById("replies-" + parentId);
          let repliesHtml = "";
          for (const rdoc of repliesSnaps.docs) {
            const rd = rdoc.data();
            const dt = (rd.timestamp && rd.timestamp.toDate) ? rd.timestamp.toDate().toLocaleString() : "Just now";
            repliesHtml += '<div class="reply-item" style="margin-top:4px;">↳ ' + rd.text + ' <span style="font-size:.87em;color:#ffd700;">' + dt + '</span></div>';
          }
          if(repliesEl) repliesEl.innerHTML = repliesHtml;
        }
        loadFeedbacks();
      `;
      document.body.appendChild(script);
    }
  </script>
</body>
</html>
